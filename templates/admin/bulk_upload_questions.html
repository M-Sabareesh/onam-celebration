{% extends "admin/base_site.html" %}
{% load static %}

{% block title %}Manage Questions - {{ site_title|default:"Django site admin" }}{% endblock %}

{% block content %}
<div style="padding: 20px;">
    <h1>üìù Manage Chodya Onam Questions</h1>
    
    {% if messages %}
        {% for message in messages %}
            <div class="alert alert-{{ message.tags }}" style="padding: 10px; margin: 10px 0; border-radius: 4px; background-color: {% if message.tags == 'success' %}#d4edda{% elif message.tags == 'error' %}#f8d7da{% else %}#d1ecf1{% endif %};">
                {{ message }}
            </div>
        {% endfor %}
    {% endif %}
    
    <!-- Add New Question Form -->
    <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 30px;">
        <h2>‚ûï Add New Question</h2>
        
        <form method="post" style="display: grid; gap: 15px;">
            {% csrf_token %}
            
            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px;">
                <div>
                    <label for="question_type"><strong>Question Type:</strong></label>
                    <select name="question_type" id="question_type" required 
                            style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;"
                            onchange="toggleQuestionFields()">
                        <option value="">Select Type</option>
                        {% for type_key, type_name in question_types %}
                            <option value="{{ type_key }}">{{ type_name }}</option>
                        {% endfor %}
                    </select>
                </div>
                
                <div>
                    <label for="order"><strong>Question Order:</strong></label>
                    <input type="number" name="order" id="order" value="{{ next_order }}" min="1" required
                           style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                </div>
                
                <div>
                    <label for="points"><strong>Points:</strong></label>
                    <input type="number" name="points" id="points" value="10" min="1" required
                           style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                </div>
            </div>
            
            <div>
                <label for="question_text"><strong>Question Text:</strong></label>
                <textarea name="question_text" id="question_text" required rows="3"
                          style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px; resize: vertical;"
                          placeholder="Enter your Chodya Onam question here..."></textarea>
            </div>
            
            <!-- Multiple Choice Options (hidden by default) -->
            <div id="multiple_choice_options" style="display: none;">
                <h4>Multiple Choice Options:</h4>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div>
                        <label for="option_a">Option A:</label>
                        <input type="text" name="option_a" id="option_a" 
                               style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                    </div>
                    <div>
                        <label for="option_b">Option B:</label>
                        <input type="text" name="option_b" id="option_b" 
                               style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                    </div>
                    <div>
                        <label for="option_c">Option C:</label>
                        <input type="text" name="option_c" id="option_c" 
                               style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                    </div>
                    <div>
                        <label for="option_d">Option D:</label>
                        <input type="text" name="option_d" id="option_d" 
                               style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                    </div>
                </div>
            </div>
            
            <div id="correct_answer_field" style="display: none;">
                <label for="correct_answer"><strong>Correct Answer:</strong></label>
                <input type="text" name="correct_answer" id="correct_answer" 
                       style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;"
                       placeholder="Enter the correct answer or select option (A, B, C, D)">
            </div>
            
            <div style="text-align: right;">
                <button type="submit" class="button" style="background-color: #28a745; font-size: 16px; padding: 10px 20px;">
                    ‚ûï Add Question
                </button>
            </div>
        </form>
    </div>
    
    <!-- Existing Questions -->
    <div>
        <h2>üìã Current Questions ({{ questions.count }})</h2>
        
        {% if questions %}
            <div style="overflow-x: auto;">
                <table style="width: 100%; border-collapse: collapse; background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                    <thead>
                        <tr style="background-color: #007cba; color: white;">
                            <th style="padding: 12px; text-align: left; border-bottom: 1px solid #ddd;">Order</th>
                            <th style="padding: 12px; text-align: left; border-bottom: 1px solid #ddd;">Question</th>
                            <th style="padding: 12px; text-align: left; border-bottom: 1px solid #ddd;">Type</th>
                            <th style="padding: 12px; text-align: left; border-bottom: 1px solid #ddd;">Points</th>
                            <th style="padding: 12px; text-align: left; border-bottom: 1px solid #ddd;">Status</th>
                            <th style="padding: 12px; text-align: left; border-bottom: 1px solid #ddd;">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for question in questions %}
                            <tr style="{% cycle 'background-color: #f8f9fa;' '' %}">
                                <td style="padding: 12px; border-bottom: 1px solid #eee;">{{ question.order }}</td>
                                <td style="padding: 12px; border-bottom: 1px solid #eee;">
                                    {{ question.question_text|truncatechars:80 }}
                                    {% if question.question_type == 'multiple_choice' %}
                                        <br><small style="color: #666;">
                                            A: {{ question.option_a|truncatechars:20 }} | 
                                            B: {{ question.option_b|truncatechars:20 }}<br>
                                            C: {{ question.option_c|truncatechars:20 }} | 
                                            D: {{ question.option_d|truncatechars:20 }}<br>
                                            <strong>Answer: {{ question.correct_answer }}</strong>
                                        </small>
                                    {% elif question.correct_answer %}
                                        <br><small style="color: #666;"><strong>Answer:</strong> {{ question.correct_answer|truncatechars:30 }}</small>
                                    {% endif %}
                                </td>
                                <td style="padding: 12px; border-bottom: 1px solid #eee;">
                                    <span style="background-color: #e9ecef; padding: 2px 8px; border-radius: 12px; font-size: 12px;">
                                        {{ question.get_question_type_display }}
                                    </span>
                                </td>
                                <td style="padding: 12px; border-bottom: 1px solid #eee;">{{ question.points }}</td>
                                <td style="padding: 12px; border-bottom: 1px solid #eee;">
                                    {% if question.is_active %}
                                        <span style="color: #28a745;">‚úÖ Active</span>
                                    {% else %}
                                        <span style="color: #dc3545;">‚ùå Inactive</span>
                                    {% endif %}
                                </td>
                                <td style="padding: 12px; border-bottom: 1px solid #eee;">
                                    <a href="{% url 'admin:core_treasurehuntquestion_change' question.id %}" 
                                       style="color: #007cba; text-decoration: none; margin-right: 10px;">‚úèÔ∏è Edit</a>
                                    <a href="{% url 'admin:core_treasurehuntquestion_delete' question.id %}" 
                                       style="color: #dc3545; text-decoration: none;"
                                       onclick="return confirm('Are you sure you want to delete this question?')">üóëÔ∏è Delete</a>
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        {% else %}
            <div style="text-align: center; padding: 40px; background: #f8f9fa; border-radius: 8px;">
                <h3>No questions yet</h3>
                <p>Add your first Chodya Onam question using the form above!</p>
            </div>
        {% endif %}
    </div>
    
    <div style="margin-top: 30px; text-align: center;">
        <a href="{% url 'admin:index' %}" class="button">Back to Dashboard</a>
        <a href="{% url 'admin:core_treasurehuntquestion_changelist' %}" class="button">Advanced Question Management</a>
    </div>
</div>

<style>
.button {
    background-color: #417690;
    color: white;
    padding: 8px 16px;
    text-decoration: none;
    border-radius: 4px;
    border: none;
    cursor: pointer;
    display: inline-block;
    margin: 5px;
}

.button:hover {
    background-color: #205067;
    color: white;
    text-decoration: none;
}

.alert {
    border-radius: 4px;
    padding: 10px;
    margin: 10px 0;
}
</style>

<script>
function toggleQuestionFields() {
    const questionType = document.getElementById('question_type').value;
    const multipleChoiceOptions = document.getElementById('multiple_choice_options');
    const correctAnswerField = document.getElementById('correct_answer_field');
    
    if (questionType === 'multiple_choice') {
        multipleChoiceOptions.style.display = 'block';
        correctAnswerField.style.display = 'block';
        document.getElementById('correct_answer').placeholder = 'Enter the correct option (A, B, C, or D)';
    } else if (questionType === 'text') {
        multipleChoiceOptions.style.display = 'none';
        correctAnswerField.style.display = 'block';
        document.getElementById('correct_answer').placeholder = 'Enter the expected answer (for reference)';
    } else {
        multipleChoiceOptions.style.display = 'none';
        correctAnswerField.style.display = 'none';
    }
}
</script>
{% endblock %}
